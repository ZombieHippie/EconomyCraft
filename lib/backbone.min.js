(function(){var u=this;var s=u.Backbone;var b=[];var t=b.push;var y=b.slice;var A=b.splice;var d;if(typeof exports!=="undefined"){d=exports}else{d=u.Backbone={}}d.VERSION="0.9.10";var a=u._;if(!a&&(typeof require!=="undefined")){a=require("underscore")}d.$=u.jQuery||u.Zepto||u.ender;d.noConflict=function(){u.Backbone=s;return this};d.emulateHTTP=false;d.emulateJSON=false;var j=/\s+/;var i=function(M,G,K,N){if(!K){return true}if(typeof K==="object"){for(var I in K){M[G].apply(M,[I,K[I]].concat(N))}}else{if(j.test(K)){var L=K.split(j);for(var H=0,J=L.length;H<J;H++){M[G].apply(M,[L[H]].concat(N))}}else{return true}}};var C=function(I,G){var H,J=-1,K=I.length;switch(G.length){case 0:while(++J<K){(H=I[J]).callback.call(H.ctx)}return;case 1:while(++J<K){(H=I[J]).callback.call(H.ctx,G[0])}return;case 2:while(++J<K){(H=I[J]).callback.call(H.ctx,G[0],G[1])}return;case 3:while(++J<K){(H=I[J]).callback.call(H.ctx,G[0],G[1],G[2])}return;default:while(++J<K){(H=I[J]).callback.apply(H.ctx,G)}}};var h=d.Events={on:function(J,G,H){if(!(i(this,"on",J,[G,H])&&G)){return this}this._events||(this._events={});var I=this._events[J]||(this._events[J]=[]);I.push({callback:G,context:H,ctx:H||this});return this},once:function(I,G,H){if(!(i(this,"once",I,[G,H])&&G)){return this}var K=this;var J=a.once(function(){K.off(I,J);G.apply(this,arguments)});J._callback=G;this.on(I,J,H);return this},off:function(P,G,H){var O,I,J,Q,K,N,L,M;if(!this._events||!i(this,"off",P,[G,H])){return this}if(!P&&!G&&!H){this._events={};return this}Q=P?[P]:a.keys(this._events);for(K=0,N=Q.length;K<N;K++){P=Q[K];if(O=this._events[P]){J=[];if(G||H){for(L=0,M=O.length;L<M;L++){I=O[L];if((G&&G!==I.callback&&G!==I.callback._callback)||(H&&H!==I.context)){J.push(I)}}}this._events[P]=J}}return this},trigger:function(J){if(!this._events){return this}var H=y.call(arguments,1);if(!i(this,"trigger",J,H)){return this}var I=this._events[J];var G=this._events.all;if(I){C(I,H)}if(G){C(G,arguments)}return this},listenTo:function(K,J,G){var I=this._listeners||(this._listeners={});var H=K._listenerId||(K._listenerId=a.uniqueId("l"));I[H]=K;K.on(J,typeof J==="object"?this:G,this);return this},stopListening:function(K,J,G){var I=this._listeners;if(!I){return}if(K){K.off(J,typeof J==="object"?this:G,this);if(!J&&!G){delete I[K._listenerId]}}else{if(typeof J==="object"){G=this}for(var H in I){I[H].off(J,G,this)}this._listeners={}}return this}};h.bind=h.on;h.unbind=h.off;a.extend(d,h);var p=d.Model=function(G,J){var I;var H=G||{};this.cid=a.uniqueId("c");this.attributes={};if(J&&J.collection){this.collection=J.collection}if(J&&J.parse){H=this.parse(H,J)||{}}if(I=a.result(this,"defaults")){H=a.defaults({},H,I)}this.set(H,J);this.changed={};this.initialize.apply(this,arguments)};a.extend(p.prototype,h,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(G){return a.clone(this.attributes)},sync:function(){return d.sync.apply(this,arguments)},get:function(G){return this.attributes[G]},escape:function(G){return a.escape(this.get(G))},has:function(G){return this.get(G)!=null},set:function(M,S,O){var G,H,R,I,Q,J,P,K;if(M==null){return this}if(typeof M==="object"){H=M;O=S}else{(H={})[M]=S}O||(O={});if(!this._validate(H,O)){return false}R=O.unset;Q=O.silent;I=[];J=this._changing;this._changing=true;if(!J){this._previousAttributes=a.clone(this.attributes);this.changed={}}K=this.attributes,P=this._previousAttributes;if(this.idAttribute in H){this.id=H[this.idAttribute]}for(G in H){S=H[G];if(!a.isEqual(K[G],S)){I.push(G)}if(!a.isEqual(P[G],S)){this.changed[G]=S}else{delete this.changed[G]}R?delete K[G]:K[G]=S}if(!Q){if(I.length){this._pending=true}for(var L=0,N=I.length;L<N;L++){this.trigger("change:"+I[L],this,K[I[L]],O)}}if(J){return this}if(!Q){while(this._pending){this._pending=false;this.trigger("change",this,O)}}this._pending=false;this._changing=false;return this},unset:function(G,H){return this.set(G,void 0,a.extend({},H,{unset:true}))},clear:function(I){var G={};for(var H in this.attributes){G[H]=void 0}return this.set(G,a.extend({},I,{unset:true}))},hasChanged:function(G){if(G==null){return !a.isEmpty(this.changed)}return a.has(this.changed,G)},changedAttributes:function(I){if(!I){return this.hasChanged()?a.clone(this.changed):false}var K,H=false;var J=this._changing?this._previousAttributes:this.attributes;for(var G in I){if(a.isEqual(J[G],(K=I[G]))){continue}(H||(H={}))[G]=K}return H},previous:function(G){if(G==null||!this._previousAttributes){return null}return this._previousAttributes[G]},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(G){G=G?a.clone(G):{};if(G.parse===void 0){G.parse=true}var H=G.success;G.success=function(I,K,J){if(!I.set(I.parse(K,J),J)){return false}if(H){H(I,K,J)}};return this.sync("read",this,G)},save:function(I,M,K){var H,L,J,N,G=this.attributes;if(I==null||typeof I==="object"){H=I;K=M}else{(H={})[I]=M}if(H&&(!K||!K.wait)&&!this.set(H,K)){return false}K=a.extend({validate:true},K);if(!this._validate(H,K)){return false}if(H&&K.wait){this.attributes=a.extend({},G,H)}if(K.parse===void 0){K.parse=true}L=K.success;K.success=function(O,Q,P){O.attributes=G;var R=O.parse(Q,P);if(P.wait){R=a.extend(H||{},R)}if(a.isObject(R)&&!O.set(R,P)){return false}if(L){L(O,Q,P)}};J=this.isNew()?"create":(K.patch?"patch":"update");if(J==="patch"){K.attrs=H}N=this.sync(J,this,K);if(H&&K.wait){this.attributes=G}return N},destroy:function(I){I=I?a.clone(I):{};var H=this;var J=I.success;var G=function(){H.trigger("destroy",H,H.collection,I)};I.success=function(L,N,M){if(M.wait||L.isNew()){G()}if(J){J(L,N,M)}};if(this.isNew()){I.success(this,null,I);return false}var K=this.sync("delete",this,I);if(!I.wait){G()}return K},url:function(){var G=a.result(this,"urlRoot")||a.result(this.collection,"url")||D();if(this.isNew()){return G}return G+(G.charAt(G.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(H,G){return H},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(G){return !this.validate||!this.validate(this.attributes,G)},_validate:function(G,I){if(!I.validate||!this.validate){return true}G=a.extend({},this.attributes,G);var H=this.validationError=this.validate(G,I)||null;if(!H){return true}this.trigger("invalid",this,H,I||{});return false}});var e=d.Collection=function(G,H){H||(H={});if(H.model){this.model=H.model}if(H.comparator!==void 0){this.comparator=H.comparator}this.models=[];this._reset();this.initialize.apply(this,arguments);if(G){this.reset(G,a.extend({silent:true},H))}};a.extend(e.prototype,h,{model:p,initialize:function(){},toJSON:function(G){return this.map(function(H){return H.toJSON(G)})},sync:function(){return d.sync.apply(this,arguments)},add:function(O,P){O=a.isArray(O)?O.slice():[O];P||(P={});var L,M,N,I,K,J,G,H,Q,R;G=[];H=P.at;Q=this.comparator&&(H==null)&&P.sort!=false;R=a.isString(this.comparator)?this.comparator:null;for(L=0,M=O.length;L<M;L++){if(!(N=this._prepareModel(I=O[L],P))){this.trigger("invalid",this,I,P);continue}if(K=this.get(N)){if(P.merge){K.set(I===N?N.attributes:I,P);if(Q&&!J&&K.hasChanged(R)){J=true}}continue}G.push(N);N.on("all",this._onModelEvent,this);this._byId[N.cid]=N;if(N.id!=null){this._byId[N.id]=N}}if(G.length){if(Q){J=true}this.length+=G.length;if(H!=null){A.apply(this.models,[H,0].concat(G))}else{t.apply(this.models,G)}}if(J){this.sort({silent:true})}if(P.silent){return this}for(L=0,M=G.length;L<M;L++){(N=G[L]).trigger("add",N,this,P)}if(J){this.trigger("sort",this,P)}return this},remove:function(K,L){K=a.isArray(K)?K.slice():[K];L||(L={});var G,I,H,J;for(G=0,I=K.length;G<I;G++){J=this.get(K[G]);if(!J){continue}delete this._byId[J.id];delete this._byId[J.cid];H=this.indexOf(J);this.models.splice(H,1);this.length--;if(!L.silent){L.index=H;J.trigger("remove",J,this,L)}this._removeReference(J)}return this},push:function(G,H){G=this._prepareModel(G,H);this.add(G,a.extend({at:this.length},H));return G},pop:function(H){var G=this.at(this.length-1);this.remove(G,H);return G},unshift:function(G,H){G=this._prepareModel(G,H);this.add(G,a.extend({at:0},H));return G},shift:function(H){var G=this.at(0);this.remove(G,H);return G},slice:function(G,H){return this.models.slice(G,H)},get:function(G){if(G==null){return void 0}this._idAttr||(this._idAttr=this.model.prototype.idAttribute);return this._byId[G.id||G.cid||G[this._idAttr]||G]},at:function(G){return this.models[G]},where:function(G){if(a.isEmpty(G)){return[]}return this.filter(function(I){for(var H in G){if(G[H]!==I.get(H)){return false}}return true})},sort:function(G){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}G||(G={});if(a.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(a.bind(this.comparator,this))}if(!G.silent){this.trigger("sort",this,G)}return this},pluck:function(G){return a.invoke(this.models,"get",G)},update:function(M,N){N=a.extend({add:true,merge:true,remove:true},N);if(N.parse){M=this.parse(M,N)}var K,I,J,H;var G=[],O=[],L={};if(!a.isArray(M)){M=M?[M]:[]}if(N.add&&!N.remove){return this.add(M,N)}for(I=0,J=M.length;I<J;I++){K=M[I];H=this.get(K);if(N.remove&&H){L[H.cid]=true}if((N.add&&!H)||(N.merge&&H)){G.push(K)}}if(N.remove){for(I=0,J=this.models.length;I<J;I++){K=this.models[I];if(!L[K.cid]){O.push(K)}}}if(O.length){this.remove(O,N)}if(G.length){this.add(G,N)}return this},reset:function(I,J){J||(J={});if(J.parse){I=this.parse(I,J)}for(var G=0,H=this.models.length;G<H;G++){this._removeReference(this.models[G])}J.previousModels=this.models.slice();this._reset();if(I){this.add(I,a.extend({silent:true},J))}if(!J.silent){this.trigger("reset",this,J)}return this},fetch:function(G){G=G?a.clone(G):{};if(G.parse===void 0){G.parse=true}var H=G.success;G.success=function(I,L,K){var J=K.update?"update":"reset";I[J](L,K);if(H){H(I,L,K)}};return this.sync("read",this,G)},create:function(H,I){I=I?a.clone(I):{};if(!(H=this._prepareModel(H,I))){return false}if(!I.wait){this.add(H,I)}var G=this;var J=I.success;I.success=function(K,M,L){if(L.wait){G.add(K,L)}if(J){J(K,M,L)}};H.save(null,I);return H},parse:function(H,G){return H},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models.length=0;this._byId={}},_prepareModel:function(G,I){if(G instanceof p){if(!G.collection){G.collection=this}return G}I||(I={});I.collection=this;var H=new this.model(G,I);if(!H._validate(G,I)){return false}return H},_removeReference:function(G){if(this===G.collection){delete G.collection}G.off("all",this._onModelEvent,this)},_onModelEvent:function(H,I,G,J){if((H==="add"||H==="remove")&&G!==this){return}if(H==="destroy"){this.remove(I,J)}if(I&&H==="change:"+I.idAttribute){delete this._byId[I.previous(I.idAttribute)];if(I.id!=null){this._byId[I.id]=I}}this.trigger.apply(this,arguments)},sortedIndex:function(I,J,G){J||(J=this.comparator);var H=a.isFunction(J)?J:function(K){return K.get(J)};return a.sortedIndex(this.models,I,H,G)}});var o=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];a.each(o,function(G){e.prototype[G]=function(){var H=y.call(arguments);H.unshift(this.models);return a[G].apply(a,H)}});var c=["groupBy","countBy","sortBy"];a.each(c,function(G){e.prototype[G]=function(J,H){var I=a.isFunction(J)?J:function(K){return K.get(J)};return a[G](this.models,I,H)}});var w=d.Router=function(G){G||(G={});if(G.routes){this.routes=G.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var r=/\((.*?)\)/g;var q=/(\(\?)?:\w+/g;var z=/\*\w+/g;var g=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(w.prototype,h,{initialize:function(){},route:function(I,H,G){if(!a.isRegExp(I)){I=this._routeToRegExp(I)}if(!G){G=this[H]}d.history.route(I,a.bind(function(K){var J=this._extractParameters(I,K);G&&G.apply(this,J);this.trigger.apply(this,["route:"+H].concat(J));this.trigger("route",H,J);d.history.trigger("route",this,H,J)},this));return this},navigate:function(G,H){d.history.navigate(G,H);return this},_bindRoutes:function(){if(!this.routes){return}var G,H=a.keys(this.routes);while((G=H.pop())!=null){this.route(G,this.routes[G])}},_routeToRegExp:function(G){G=G.replace(g,"\\$&").replace(r,"(?:$1)?").replace(q,function(H,I){return I?H:"([^/]+)"}).replace(z,"(.*?)");return new RegExp("^"+G+"$")},_extractParameters:function(H,G){return H.exec(G).slice(1)}});var l=d.History=function(){this.handlers=[];a.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var x=/^[#\/]|\s+$/g;var v=/^\/+|\/+$/g;var m=/msie [\w.]+/;var B=/\/$/;l.started=false;a.extend(l.prototype,h,{interval:50,getHash:function(H){var G=(H||this).location.href.match(/#(.*)$/);return G?G[1]:""},getFragment:function(H,G){if(H==null){if(this._hasPushState||!this._wantsHashChange||G){H=this.location.pathname;var I=this.root.replace(B,"");if(!H.indexOf(I)){H=H.substr(I.length)}}else{H=this.getHash()}}return H.replace(x,"")},start:function(L){if(l.started){throw new Error("Backbone.history has already been started")}l.started=true;this.options=a.extend({},{root:"/"},this.options,L);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var I=this.getFragment();var H=document.documentMode;var K=(m.exec(navigator.userAgent.toLowerCase())&&(!H||H<=7));this.root=("/"+this.root+"/").replace(v,"/");if(K&&this._wantsHashChange){this.iframe=d.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(I)}if(this._hasPushState){d.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!K){d.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=I;var J=this.location;var G=J.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!G){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&G&&J.hash){this.fragment=this.getHash().replace(x,"");this.history.replaceState({},document.title,this.root+this.fragment+J.search)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){d.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);l.started=false},route:function(H,G){this.handlers.unshift({route:H,callback:G})},checkUrl:function(H){var G=this.getFragment();if(G===this.fragment&&this.iframe){G=this.getFragment(this.getHash(this.iframe))}if(G===this.fragment){return false}if(this.iframe){this.navigate(G)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(H){var G=this.fragment=this.getFragment(H);var I=a.any(this.handlers,function(J){if(J.route.test(G)){J.callback(G);return true}});return I},navigate:function(G,H){if(!l.started){return false}if(!H||H===true){H={trigger:H}}G=this.getFragment(G||"");if(this.fragment===G){return}this.fragment=G;var I=this.root+G;if(this._hasPushState){this.history[H.replace?"replaceState":"pushState"]({},document.title,I)}else{if(this._wantsHashChange){this._updateHash(this.location,G,H.replace);if(this.iframe&&(G!==this.getFragment(this.getHash(this.iframe)))){if(!H.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,G,H.replace)}}else{return this.location.assign(I)}}if(H.trigger){this.loadUrl(G)}},_updateHash:function(I,G,J){if(J){var H=I.href.replace(/(javascript:|#).*$/,"");I.replace(H+"#"+G)}else{I.hash="#"+G}}});d.history=new l;var E=d.View=function(G){this.cid=a.uniqueId("view");this._configure(G||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var f=/^(\S+)\s*(.*)$/;var F=["model","collection","el","id","attributes","className","tagName","events"];a.extend(E.prototype,h,{tagName:"div",$:function(G){return this.$el.find(G)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(H,G){if(this.$el){this.undelegateEvents()}this.$el=H instanceof d.$?H:d.$(H);this.el=this.$el[0];if(G!==false){this.delegateEvents()}return this},delegateEvents:function(H){if(!(H||(H=a.result(this,"events")))){return}this.undelegateEvents();for(var I in H){var K=H[I];if(!a.isFunction(K)){K=this[H[I]]}if(!K){throw new Error('Method "'+H[I]+'" does not exist')}var J=I.match(f);var G=J[1],L=J[2];K=a.bind(K,this);G+=".delegateEvents"+this.cid;if(L===""){this.$el.on(G,K)}else{this.$el.on(G,L,K)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(G){if(this.options){G=a.extend({},a.result(this,"options"),G)}a.extend(this,a.pick(G,F));this.options=G},_ensureElement:function(){if(!this.el){var H=a.extend({},a.result(this,"attributes"));if(this.id){H.id=a.result(this,"id")}if(this.className){H["class"]=a.result(this,"className")}var G=d.$("<"+a.result(this,"tagName")+">").attr(H);this.setElement(G,false)}else{this.setElement(a.result(this,"el"),false)}}});var n={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};d.sync=function(I,J,K){var N=n[I];a.defaults(K||(K={}),{emulateHTTP:d.emulateHTTP,emulateJSON:d.emulateJSON});var L={type:N,dataType:"json"};if(!K.url){L.url=a.result(J,"url")||D()}if(K.data==null&&J&&(I==="create"||I==="update"||I==="patch")){L.contentType="application/json";L.data=JSON.stringify(K.attrs||J.toJSON(K))}if(K.emulateJSON){L.contentType="application/x-www-form-urlencoded";L.data=L.data?{model:L.data}:{}}if(K.emulateHTTP&&(N==="PUT"||N==="DELETE"||N==="PATCH")){L.type="POST";if(K.emulateJSON){L.data._method=N}var G=K.beforeSend;K.beforeSend=function(P){P.setRequestHeader("X-HTTP-Method-Override",N);if(G){return G.apply(this,arguments)}}}if(L.type!=="GET"&&!K.emulateJSON){L.processData=false}var M=K.success;K.success=function(P){if(M){M(J,P,K)}J.trigger("sync",J,P,K)};var H=K.error;K.error=function(P){if(H){H(J,P,K)}J.trigger("error",J,P,K)};var O=K.xhr=d.ajax(a.extend(L,K));J.trigger("request",J,O,K);return O};d.ajax=function(){return d.$.ajax.apply(d.$,arguments)};var k=function(I,J){var H=this;var G;if(I&&a.has(I,"constructor")){G=I.constructor}else{G=function(){return H.apply(this,arguments)}}a.extend(G,H,J);var K=function(){this.constructor=G};K.prototype=H.prototype;G.prototype=new K;if(I){a.extend(G.prototype,I)}G.__super__=H.prototype;return G};p.extend=e.extend=w.extend=E.extend=l.extend=k;var D=function(){throw new Error('A "url" property or function must be specified')}}).call(this);